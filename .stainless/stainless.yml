# yaml-language-server: $schema=https://app.stainless.com/config.schema.json

# The main edition for the config, see the [docs] for more information.
#
# [docs]: https://www.stainless.com/docs/reference/editions
edition: 2025-10-10

organization:
  # Name of your organization or company, used to determine the name of the client
  # and headings.
  name: Lightspark Grid
  # Link to your API documentation.
  docs: 'grid.lightspark.com'
  # Contact email for bug reports, questions, and support requests.
  contact: support@lightspark.com

# `targets` define the output targets and their customization options, such as
# whether to emit the Node SDK and what its package name should be.
targets:
  typescript:
    # The edition for this target, see the [docs] for more information.
    #
    # [docs]: https://www.stainless.com/docs/reference/editions
    edition: typescript.2025-10-10
    package_name: "@lightsparkdev/grid"
    production_repo: lightsparkdev/grid-js-sdk
    publish:
      npm:
        auth_method: oidc
      # jsr:
      #   package_name: "@lightsparkdev/grid"
    options:
      mcp_server:
        host:
          stainless: true
        package_name: "@lightsparkdev/grid-mcp"
  kotlin:
    edition: kotlin.2025-10-08
    reverse_domain: com.lightspark.grid
    production_repo: lightsparkdev/grid-kotlin-sdk
    publish:
      maven:
        sonatype_platform: portal
  python:
    edition: python.2025-11-20
    package_name: grid
    production_repo: null
    publish:
      pypi: false

# `environments` are a map of the name of the environment (e.g. "sandbox",
# "production") to the corresponding url to use.
environments:
  production: https://api.lightspark.com/grid/2025-10-13

# `resources` define the structure and organization for your API, such as how
# methods and models are grouped together and accessed. See the [configuration
# guide] for more information.
#
# [configuration guide]: https://www.stainless.com/docs/guides/configure#resources
resources:
  config:
    # Configure the methods defined in this resource. Each key in the object is the
    # name of the method and the value is either an endpoint (for example, `get /foo`)
    # or an object with more detail.
    #
    # [reference]: https://www.stainless.com/docs/reference/config#method
    # Configure the models--named types--defined in the resource. Each key in the
    # object is the name of the model and the value is either the name of a schema in
    # `#/components/schemas` or an object with more detail.
    #
    # [reference]: https://www.stainless.com/docs/reference/config#model
    models:
      customer_info_field_name: '#/components/schemas/CustomerInfoFieldName'
      platform_currency_config: '#/components/schemas/PlatformCurrencyConfig'
      platform_config: '#/components/schemas/PlatformConfig'
    methods:
      retrieve: get /config
      update: patch /config

  customers:
    models:
      # customer_type: '#/components/schemas/CustomerType'
      # individual_customer: '#/components/schemas/IndividualCustomer'
      customer: '#/components/schemas/Customer'
      # address: '#/components/schemas/Address'
      # ultimate_beneficial_owner: '#/components/schemas/UltimateBeneficialOwner'
      # business_customer: '#/components/schemas/BusinessCustomer'
      # business_customer_fields: "#/components/schemas/BusinessCustomerFields"
      # business_info: "#/components/schemas/BusinessInfo"
      # individual_customer_fields: "#/components/schemas/IndividualCustomerFields"
      customer_one_of: "#/components/schemas/CustomerOneOf"
      customer_create: "#/components/schemas/CustomerCreateRequest"
      customer_update: "#/components/schemas/CustomerUpdateRequest"
    methods:
      create:
        endpoint: post /customers
        body_param_name: CreateCustomerRequest
      list: get /customers
      retrieve: get /customers/{customerId}
      update:
        endpoint: patch /customers/{customerId}
        body_param_name: UpdateCustomerRequest
      delete: delete /customers/{customerId}
      get_kyc_link: get /customers/kyc-link
      list_internal_accounts: get /customers/internal-accounts
    # Subresources define resources that are nested within another for more powerful
    # logical groupings, e.g. `cards.payments`.
    subresources:
      external_accounts:
        models:
          usd_account_info: '#/components/schemas/UsdExternalAccountInfo'
          brl_account_info: '#/components/schemas/BrlExternalAccountInfo'
          mxn_account_info: '#/components/schemas/MxnExternalAccountInfo'
          dkk_account_info: '#/components/schemas/DkkExternalAccountInfo'
          inr_account_info: '#/components/schemas/InrExternalAccountInfo'
          gbp_account_info: '#/components/schemas/GbpExternalAccountInfo'
          hkd_account_info: '#/components/schemas/HkdExternalAccountInfo'
          idr_account_info: '#/components/schemas/IdrExternalAccountInfo'
          myr_account_info: '#/components/schemas/MyrExternalAccountInfo'
          php_account_info: '#/components/schemas/PhpExternalAccountInfo'
          sgd_account_info: '#/components/schemas/SgdExternalAccountInfo'
          thb_account_info: '#/components/schemas/ThbExternalAccountInfo'
          vnd_account_info: '#/components/schemas/VndExternalAccountInfo'
          spark_wallet_info: '#/components/schemas/SparkWalletExternalAccountInfo'
          solana_wallet_info: '#/components/schemas/SolanaWalletExternalAccountInfo'
          tron_wallet_info: '#/components/schemas/TronWalletExternalAccountInfo'
          polygon_wallet_info: '#/components/schemas/PolygonWalletExternalAccountInfo'
          lightning_wallet_info: '#/components/schemas/LightningExternalAccountInfo'
          base_wallet_info: '#/components/schemas/BaseWalletExternalAccountInfo'
          # individual_beneficiary: '#/components/schemas/IndividualBeneficiary'
          # business_beneficiary: '#/components/schemas/BusinessBeneficiary'
          external_account: '#/components/schemas/ExternalAccount'
          external_account_create: '#/components/schemas/ExternalAccountCreateRequest'
          # base_external_account_info: "#/components/schemas/BaseExternalAccountInfo"
          # base_beneficiary: "#/components/schemas/BaseBeneficiary"
          beneficiary_one_of: "#/components/schemas/BeneficiaryOneOf"
          external_account_info_one_of: "#/components/schemas/ExternalAccountInfoOneOf"
        methods:
          list: get /customers/external-accounts
          create: post /customers/external-accounts
      bulk:
        methods:
          upload_csv: post /customers/bulk/csv
          get_job_status: get /customers/bulk/jobs/{jobId}

  platform:
    methods:
      list_internal_accounts:
        endpoint: get /platform/internal-accounts
        paginated: false
    subresources:
      external_accounts:
        methods:
          list:
            endpoint: get /platform/external-accounts
            paginated: false
          create: post /platform/external-accounts

  plaid:
    methods:
      create_link_token: post /plaid/link-tokens
      submit_public_token: post /plaid/callback/{plaid_link_token}

  transfer_in:
    models:
      transaction: '#/components/schemas/Transaction'
      base_transaction_destination: "#/components/schemas/BaseTransactionDestination"
    methods:
      create: post /transfer-in

  transfer_out:
    methods:
      create: post /transfer-out

  receiver:
    models:
      counterparty_field_definition: '#/components/schemas/CounterpartyFieldDefinition'
      lookup_response: '#/components/schemas/ReceiverLookupResponse'
    methods:
      lookup_uma: get /receiver/uma/{receiverUmaAddress}
      lookup_external_account: get /receiver/external-account/{accountId}

  quotes:
    models:
      currency: '#/components/schemas/Currency'
      payment_instructions: '#/components/schemas/PaymentInstructions'
      outgoing_rate_details: '#/components/schemas/OutgoingRateDetails'
      quote: '#/components/schemas/Quote'
      base_payment_account_info: "#/components/schemas/BasePaymentAccountInfo"
      base_quote_source: "#/components/schemas/BaseQuoteSource"
      quote_source_one_of: "#/components/schemas/QuoteSourceOneOf"
      base_destination: "#/components/schemas/BaseDestination"
      quote_destination_one_of: "#/components/schemas/QuoteDestinationOneOf"
    methods:
      retrieve: get /quotes/{quoteId}
      create: post /quotes
      list: get /quotes
      execute: post /quotes/{quoteId}/execute

  transactions:
    models:
      transaction_type: '#/components/schemas/TransactionType'
      transaction_destination_one_of: '#/components/schemas/TransactionDestinationOneOf'
      counterparty_information: '#/components/schemas/CounterpartyInformation'
      incoming_transaction: '#/components/schemas/IncomingTransaction'
      transaction_status: '#/components/schemas/TransactionStatus'
      base_transaction_source: "#/components/schemas/BaseTransactionSource"
      transaction_source_one_of: "#/components/schemas/TransactionSourceOneOf"
    methods:
      list: get /transactions
      retrieve: get /transactions/{transactionId}
      approve: post /transactions/{transactionId}/approve
      reject: post /transactions/{transactionId}/reject

  webhooks:
    methods:
      unwrap:
        type: webhook_unwrap
        discriminator: type
      

  invitations:
    models:
      currency_amount: '#/components/schemas/CurrencyAmount'
      uma_invitation: '#/components/schemas/UmaInvitation'
    methods:
      create: post /invitations
      retrieve: get /invitations/{invitationCode}
      claim: post /invitations/{invitationCode}/claim
      cancel: post /invitations/{invitationCode}/cancel

  sandbox:
    methods:
      send_funds: post /sandbox/send
      send_test_webhook: post /webhooks/test
    subresources:
      uma:
        methods:
          receive_payment: post /sandbox/uma/receive
      internal_accounts:
        models:
          internal_account: '#/components/schemas/InternalAccount'
        methods:
          fund: post /sandbox/internal-accounts/{accountId}/fund

  uma_providers:
    methods:
      list: get /uma-providers

  tokens:
    models:
      permission: '#/components/schemas/Permission'
      api_token: '#/components/schemas/ApiToken'
    methods:
      create: post /tokens
      list: get /tokens
      retrieve: get /tokens/{tokenId}
      delete: delete /tokens/{tokenId}
  exchange_rates:
    methods:
      list:
        endpoint: get /exchange-rates
        paginated: false

settings:
  # All generated integration tests that hit the prism mock http server are marked
  # as skipped. Removing this setting or setting it to false enables tests, but
  # doing so may result in test failures due to bugs in the test server.
  #
  # [prism mock http server]: https://stoplight.io/open-source/prism
  disable_mock_tests: true
  license: Apache-2.0

# `client_settings` define settings for the API client, such as extra constructor
# arguments (used for authentication), retry behavior, idempotency, etc.
client_settings:
  opts:
    username:
      type: string
      nullable: false
      auth:
        security_scheme: BasicAuth
        role: username
      description: API token authentication using format `<api token id>:<api client secret>`
      read_env: GRID_CLIENT_ID
    password:
      type: string
      nullable: false
      auth:
        security_scheme: BasicAuth
        role: password
      description: API token authentication using format `<api token id>:<api client secret>`
      read_env: GRID_CLIENT_SECRET
    webhook_signature:
      type: string
      nullable: true
      auth:
        security_scheme: WebhookSignature
      description: |
        Secp256r1 (P-256) asymmetric signature of the webhook payload, which can be used to verify that the webhook was sent by Grid.

        To verify the signature:
        1. Get the Grid public key provided to you during integration
        2. Decode the base64 signature from the header
        3. Create a SHA-256 hash of the request body
        4. Verify the signature using the public key and the hash

        If the signature verification succeeds, the webhook is authentic. If not, it should be rejected.
      read_env: GRID_WEBHOOK_PUBKEY

# `readme` is used to configure the code snippets that will be rendered in the
# README.md of various SDKs. In particular, you can change the `headline`
# snippet's endpoint and the arguments to call it with.
readme:
  example_requests:
    default:
      type: request
      endpoint: post /quotes
      params: {}
    headline:
      type: request
      endpoint: post /quotes
      params: {}
    pagination:
      type: request
      endpoint: get /customers
      params: {}

pagination:
  - name: default_pagination
    type: cursor
    request:
      cursor:
        type: string
        x-stainless-pagination-property:
          purpose: next_cursor_param
    response:
      data:
        type: array
        items:
          type: object
      nextCursor:
        type: string
        x-stainless-pagination-property:
          purpose: next_cursor_field
      hasMore:
        type: boolean
        x-stainless-pagination-property:
          purpose: has_next_page
      totalCount:
        type: integer

openapi:
  code_samples: mintlify
  transformations:
    # # ── customerType: IndividualCustomerFields / BusinessCustomerFields ──
    # - command: remove
    #   reason: >-
    #     Remove inline customerType enums from customer fields schemas to avoid
    #     conflicting types when allOf merges them with base schemas (Customer,
    #     CustomerCreateRequest, CustomerUpdateRequest) that define customerType
    #     via the shared CustomerType $ref
    #   args:
    #     target:
    #       - "$.components.schemas.IndividualCustomerFields.properties"
    #       - "$.components.schemas.BusinessCustomerFields.properties"
    #     keys: [ "customerType" ]

    # # ── accountType: common account info schemas ──
    # - command: remove
    #   reason: >-
    #     Remove inline accountType enums from common account info schemas to
    #     avoid conflicting types when allOf merges them with
    #     BaseExternalAccountInfo or BasePaymentAccountInfo, which define
    #     accountType via shared $ref enums
    #   args:
    #     target:
    #       - "$.components.schemas.UsAccountInfo.properties"
    #       - "$.components.schemas.ClabeAccountInfo.properties"
    #       - "$.components.schemas.PixAccountInfo.properties"
    #       - "$.components.schemas.IbanAccountInfo.properties"
    #       - "$.components.schemas.UpiAccountInfo.properties"
    #       - "$.components.schemas.NgnAccountInfo.properties"
    #       - "$.components.schemas.CadAccountInfo.properties"
    #       - "$.components.schemas.GbpAccountInfo.properties"
    #       - "$.components.schemas.PhpAccountInfo.properties"
    #       - "$.components.schemas.SgdAccountInfo.properties"
    #       - "$.components.schemas.SparkWalletInfo.properties"
    #       - "$.components.schemas.LightningInfo.properties"
    #       - "$.components.schemas.SolanaWalletInfo.properties"
    #       - "$.components.schemas.TronWalletInfo.properties"
    #       - "$.components.schemas.PolygonWalletInfo.properties"
    #       - "$.components.schemas.BaseWalletInfo.properties"
    #     keys: [ "accountType" ]

    # # ── sourceType: transaction and quote source schemas ──
    # - command: remove
    #   reason: >-
    #     Remove inline sourceType enums from transaction and quote source
    #     allOf variants to avoid conflicting types with their base schemas
    #     which define sourceType via shared $ref enums
    #   args:
    #     target:
    #       - "$.components.schemas.AccountTransactionSource.allOf[1].properties"
    #       - "$.components.schemas.UmaAddressTransactionSource.allOf[1].properties"
    #       - "$.components.schemas.AccountQuoteSource.allOf[1].properties"
    #       - "$.components.schemas.RealtimeFundingQuoteSource.allOf[1].properties"
    #     keys: [ "sourceType" ]

    # ── destinationType: transaction destination schemas ──
    - command: remove
      reason: >-
        Remove inline destinationType enums from transaction and quote
        destination allOf variants to avoid conflicting types with their
        base schemas which define destinationType via shared $ref enums
      args:
        target:
          - "$.components.schemas.AccountTransactionDestination.allOf[0]"
          - "$.components.schemas.UmaAddressTransactionDestination.allOf[0]"
        keys: [ "$ref" ]

    # # ── beneficiaryType: beneficiary schemas ──
    # - command: remove
    #   reason: >-
    #     Remove inline beneficiaryType enums from beneficiary allOf variants
    #     to avoid conflicting types with BaseBeneficiary which defines
    #     beneficiaryType via a shared $ref enum
    #   args:
    #     target:
    #       - "$.components.schemas.IndividualBeneficiary.allOf[1].properties"
    #       - "$.components.schemas.BusinessBeneficiary.allOf[1].properties"
    #     keys: [ "beneficiaryType" ]
    # ── customerType: remove from base schemas ──
    - command: remove
      reason: >-
        Remove customerType $ref from base schemas so the inline single-value
        enums in IndividualCustomerFields/BusinessCustomerFields become the
        sole definition, avoiding allOf type conflicts
      args:
        target:
          - "$.components.schemas.Customer.properties"
          - "$.components.schemas.CustomerCreateRequest.properties"
          - "$.components.schemas.CustomerUpdateRequest.properties"
        keys: [ "customerType" ]

    # ── accountType: remove from base schemas ──
    - command: remove
      reason: >-
        Remove accountType $ref from base schemas so the inline single-value
        enums in each account info variant become the sole definition,
        enabling structural matching to distinguish them
      args:
        target:
          - "$.components.schemas.BaseExternalAccountInfo.properties"
          - "$.components.schemas.BasePaymentAccountInfo.properties"
        keys: [ "accountType" ]

    # ── sourceType: remove from base schemas ──
    - command: remove
      reason: >-
        Remove sourceType $ref from base schemas so the inline single-value
        enums in each source variant become the sole definition
      args:
        target:
          - "$.components.schemas.BaseTransactionSource.properties"
          - "$.components.schemas.BaseQuoteSource.properties"
        keys: [ "sourceType" ]

    # ── destinationType: remove from base schemas ──
    - command: remove
      reason: >-
        Remove destinationType $ref from base schemas so the inline
        single-value enums in each destination variant become the sole definition
      args:
        target:
          - "$.components.schemas.BaseTransactionDestination.properties"
          - "$.components.schemas.BaseDestination.properties"
        keys: [ "destinationType" ]

    # ── Remove $ref to BasePaymentAccountInfo from payment account variants ──
    - command: remove
      reason: >-
        Remove allOf $ref to BasePaymentAccountInfo from payment account variants
        because the base schema becomes an empty object (no properties) after
        stripping the accountType discriminator, which causes TS2312 errors
      args:
        target:
          - "$.components.schemas.PaymentUsdAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentBrlAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentMxnAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentDkkAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentInrAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentNgnAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentCadAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentGbpAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentHkdAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentIdrAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentMyrAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentPhpAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentSgdAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentThbAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentVndAccountInfo.allOf[0]"
          - "$.components.schemas.PaymentSparkWalletInfo.allOf[0]"
          - "$.components.schemas.PaymentLightningInvoiceInfo.allOf[0]"
          - "$.components.schemas.PaymentSolanaWalletInfo.allOf[0]"
          - "$.components.schemas.PaymentTronWalletInfo.allOf[0]"
          - "$.components.schemas.PaymentPolygonWalletInfo.allOf[0]"
          - "$.components.schemas.PaymentBaseWalletInfo.allOf[0]"
        keys: [ "$ref" ]

    # ── Remove $ref to BaseQuoteSource from quote source variants ──
    - command: remove
      reason: >-
        Remove allOf $ref to BaseQuoteSource from quote source variants
        because the base schema becomes an empty object after stripping sourceType
      args:
        target:
          - "$.components.schemas.AccountQuoteSource.allOf[0]"
          - "$.components.schemas.RealtimeFundingQuoteSource.allOf[0]"
        keys: [ "$ref" ]

    # ── Remove $ref to BaseDestination from destination variants ──
    - command: remove
      reason: >-
        Remove allOf $ref to BaseDestination from destination variants
        because the base schema becomes an empty object after stripping destinationType
      args:
        target:
          - "$.components.schemas.AccountDestination.allOf[0]"
          - "$.components.schemas.UmaAddressDestination.allOf[0]"
          - "$.components.schemas.ExternalAccountDetailsDestination.allOf[0]"
        keys: [ "$ref" ]

codeflow:
  detect_breaking_changes: true
  release_environment: npm
diagnostics:
  ignored:
    Schema/ObjectHasNoProperties:
      - pagination.0.response.data.items
    Schema/EnumHasOneMember: true
    Schema/RequiredPropertyNotDefined: true
