get:
  summary: List platform external accounts
  description: |
    Retrieve a list of all external accounts that belong to the platform, as opposed to an individual customer.

    These accounts are used for platform-wide operations such as receiving funds from external sources or managing platform-level payment destinations.
  operationId: listPlatformExternalAccounts
  tags:
    - External Accounts
  security:
    - BasicAuth: []
  parameters:
    - name: currency
      in: query
      description: Filter by currency code
      required: false
      schema:
        type: string
  responses:
    '200':
      description: Successful operation
      content:
        application/json:
          schema:
            type: object
            required:
              - accounts
            properties:
              accounts:
                type: array
                description: List of external accounts matching the filter criteria
                items:
                  $ref: ../../components/schemas/external_accounts/ExternalAccount.yaml
    '400':
      description: Bad request - Invalid parameters
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/errors/Error400.yaml
    '401':
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/errors/Error401.yaml
    '500':
      description: Internal service error
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/errors/Error500.yaml

post:
  summary: Add a new platform external account
  description: >-
    Register a new external bank account for the platform.


    **Sandbox Testing:** In sandbox mode, use these account number patterns to test different transfer scenarios.
    These patterns should be used with the primary alias, address, or identifier of whatever account type you're testing.
    For example, the US account number, a CLABE, an IBAN, a spark wallet address, etc. The failure patterns are:

    - Account numbers ending in **002**: Insufficient funds (transfer-in will fail)

    - Account numbers ending in **003**: Account closed/invalid (transfers will fail)

    - Account numbers ending in **004**: Transfer rejected (bank rejects the transfer)

    - Account numbers ending in **009**: Timeout/delayed failure (stays pending ~30s, then fails)

    - Any other account number: Success (transfers complete normally)
  operationId: createPlatformExternalAccount
  tags:
    - External Accounts
  security:
    - BasicAuth: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: ../../components/schemas/external_accounts/ExternalAccountCreateRequest.yaml
        examples:
          usBankAccount:
            summary: Create external US bank account
            value:
              currency: USD
              accountInfo:
                accountType: US_ACCOUNT
                accountNumber: "12345678901"
                routingNumber: "123456789"
                accountCategory: CHECKING
                bankName: Chase Bank
                platformAccountId: ext_acc_123456
                beneficiary:
                  beneficiaryType: INDIVIDUAL
                  fullName: John Doe
                  birthDate: "1990-01-15"
                  nationality: US
                  address:
                    line1: 123 Main Street
                    city: San Francisco
                    state: CA
                    postalCode: "94105"
                    country: US
          sparkWallet:
            summary: Create external Spark wallet
            value:
              currency: BTC
              accountInfo:
                accountType: SPARK_WALLET
                address: "sprt1pgssyuuuhnrrdjswal5c3s3rafw9w3y5dd4cjy3duxlf7hjzkp0rqx6dj6mrhu"
  responses:
    '201':
      description: External account created successfully
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/external_accounts/ExternalAccount.yaml
    '400':
      description: Bad request
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/errors/Error400.yaml
    '401':
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/errors/Error401.yaml
    '409':
      description: Conflict - External account already exists
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/errors/Error409.yaml
    '500':
      description: Internal service error
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/errors/Error500.yaml
