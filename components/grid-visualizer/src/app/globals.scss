@use '@lightsparkdev/origin/src/tokens/variables';
@use '@lightsparkdev/origin/src/tokens/fonts';
@use '@lightsparkdev/origin/src/tokens/typography';
@use '@lightsparkdev/origin/src/tokens/effects';
@use '@lightsparkdev/origin/src/tokens/reset';

:root {
  --action-bg: rgba(17, 169, 103, 0.08);
  --action-text: #118453;
  --surface-hover: var(--color-alpha-black-04);
}

[data-theme='dark'] {
  --action-bg: rgba(17, 169, 103, 0.15);
  --action-text: #11a967;
  --surface-hover: var(--color-alpha-white-06);
}

* {
  corner-shape: squircle;
}

@supports (corner-shape: squircle) {
  :root {
    --corner-radius-2xs: 3.6px;   /* 2 × 1.8 */
    --corner-radius-xs: 7.2px;    /* 4 × 1.8 */
    --corner-radius-sm: 10.8px;   /* 6 × 1.8 */
    --corner-radius-md: 14.4px;   /* 8 × 1.8 */
    --corner-radius-lg: 21.6px;   /* 12 × 1.8 */
    --corner-radius-xl: 28.8px;   /* 16 × 1.8 */
    --corner-radius-2xl: 43.2px;  /* 24 × 1.8 */
    --corner-radius-3xl: 57.6px;  /* 32 × 1.8 */
    --corner-radius-4xl: 72px;    /* 40 × 1.8 */
  }
}

body {
  background: var(--surface-primary);
  color: var(--text-primary);
  font-family: var(--font-family-sans);
  font-weight: var(--font-weight-book);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

// View transition: smooth cross-fade between mobile wizard/results views
::view-transition-old(root) {
  animation-duration: 150ms;
}

::view-transition-new(root) {
  animation-duration: 150ms;
}

// Mobile: match body bg to the active view so iOS status bar picks up the right color
@media (max-width: 767px) {
  body {
    background: var(--surface-secondary);

    [data-theme='dark'] & {
      background: var(--color-gray-975);
    }
  }
}

// Command modal height
[role='dialog'] {
  max-height: min(588px, 70vh) !important;
}

// base-ui Autocomplete: seamless mouse ↔ keyboard highlight handoff
// Mouse mode (default): hover wins, keyboard highlight suppressed on non-hovered items
[role='dialog']:not([data-keyboard-nav]) [role='option']:hover {
  background-color: var(--surface-hover) !important;
}

[role='dialog']:not([data-keyboard-nav]) [role='listbox']:hover [role='option'][data-highlighted]:not(:hover) {
  background-color: transparent !important;
}

// Keyboard mode: data-highlighted wins, hover suppressed on non-highlighted items
[role='dialog'][data-keyboard-nav] [role='option']:hover:not([data-highlighted]) {
  background-color: transparent !important;
}

// Mobile: prevent iOS zoom on input focus (requires font-size >= 16px)
@media (max-width: 767px) {
  [role='dialog'] input {
    font-size: 16px !important;
  }
}

// Mobile: make Command/Dialog popups near full-screen with 24px inset
@media (max-width: 767px) {
  [role='dialog'] {
    width: auto !important;
    max-width: none !important;
    max-height: none !important;
    top: var(--spacing-xl) !important;
    right: var(--spacing-xl) !important;
    bottom: var(--spacing-xl) !important;
    left: var(--spacing-xl) !important;
    transform: none !important;

    // Restore scale animation on open/close (more specific selector wins over base !important)
    &[data-starting-style],
    &[data-ending-style] {
      transform: scale(0.98) !important;
      opacity: 0;
    }

    // Collapse Command footer wrapper (keyboard hints hidden, remove chin)
    > :last-child {
      padding: 0 !important;
      min-height: 0 !important;
    }
  }
}
