## Cross-Currency Transfers

Use the quotes flow when sending funds with currency conversion. This locks in an exchange rate and provides all details needed to execute the transfer.

### When to use cross-currency transfers

- Converting USD, USDC, USDT to EUR, MXN, BRL, BTC, or other supported fiat and crypto currencies
- Sending international payments with automatic currency conversion
- Need to lock in a specific exchange rate for the transfer

### Create and execute a quote

<Steps>
<Step title="Create a quote">
  Request a quote to lock in the exchange rate and get transfer details:

```bash
curl -X POST 'https://api.lightspark.com/grid/2025-10-13/quotes' \
  -u "$GRID_CLIENT_ID:$GRID_CLIENT_SECRET" \
  -H 'Content-Type: application/json' \
  -d '{
    "source": { "sourceType": "ACCOUNT", "accountId": "InternalAccount:e85dcbd6-dced-4ec4-b756-3c3a9ea3d965" },
    "destination": { "destinationType": "ACCOUNT", "accountId": "ExternalAccount:a12dcbd6-dced-4ec4-b756-3c3a9ea3d123" },
    "lockedCurrencySide": "SENDING",
    "lockedCurrencyAmount": 10000,
    "description": "Payment for services - Invoice #1234"
  }'
```

```json Success (201 Created)
{
  "id": "Quote:019542f5-b3e7-1d02-0000-000000000025",
  "status": "PENDING",
  "source": { "accountId": "InternalAccount:e85dcbd6-dced-4ec4-b756-3c3a9ea3d965", "currency": "USD" },
  "destination": { "accountId": "ExternalAccount:a12dcbd6-dced-4ec4-b756-3c3a9ea3d123", "currency": "EUR" },
  "sendingAmount": { "amount": 10000, "currency": { "code": "USD", "decimals": 2 } },
  "receivingAmount": { "amount": 9200, "currency": { "code": "EUR", "decimals": 2 } },
  "exchangeRate": 0.92,
  "fee": { "amount": 50, "currency": { "code": "USD", "decimals": 2 } },
  "expiresAt": "2025-10-03T15:15:00Z",
  "createdAt": "2025-10-03T15:00:00Z",
  "description": "Payment for services - Invoice #1234"
}
```

<Info>
  **Locked currency side** determines which amount is fixed:
  - `SENDING`: Lock the sending amount (receiving amount calculated based on exchange rate)
  - `RECEIVING`: Lock the receiving amount (sending amount calculated based on exchange rate)
</Info>

<Accordion title="Including purpose of payment">
  For external account or UMA destinations, some payment corridors require a purpose of payment. Include it in the `senderCustomerInfo` object:

  ```json
  {
    "source": { "sourceType": "ACCOUNT", "accountId": "InternalAccount:..." },
    "destination": { "destinationType": "ACCOUNT", "accountId": "ExternalAccount:..." },
    "lockedCurrencySide": "SENDING",
    "lockedCurrencyAmount": 10000,
    "senderCustomerInfo": {
      "PURPOSE_OF_PAYMENT": "GOODS_OR_SERVICES"
    }
  }
  ```

  **Purpose of payment codes:**
  - `GIFT` - Personal gift
  - `SELF` - Transfer to yourself
  - `GOODS_OR_SERVICES` - Payment for goods or services
  - `EDUCATION` - Education-related expenses
  - `HEALTH_OR_MEDICAL` - Medical or healthcare expenses
  - `REAL_ESTATE_PURCHASE` - Real estate transaction
  - `TAX_PAYMENT` - Tax payment
  - `LOAN_PAYMENT` - Loan repayment
  - `UTILITY_BILL` - Utility bill payment
  - `DONATION` - Charitable donation
  - `TRAVEL` - Travel-related expenses
  - `OTHER` - Other purpose (may require additional documentation)
</Accordion>
</Step>

<Step title="Review quote details">
  Before executing, review the quote to ensure:

- Exchange rate is acceptable
- Fees are as expected
- Receiving amount meets requirements
- Quote hasn't expired (check `expiresAt`)

<Warning>
  Quotes typically expire after a short period. If expired, create a new quote to get an updated exchange rate.
</Warning>
</Step>

<Step title="Execute the quote">
  Confirm and execute the quote to initiate the transfer:

```bash
curl -X POST 'https://api.lightspark.com/grid/2025-10-13/quotes/Quote:019542f5-b3e7-1d02-0000-000000000025/execute' \
  -u "$GRID_CLIENT_ID:$GRID_CLIENT_SECRET"
```

```json Success (200 OK)
{
  "id": "Quote:019542f5-b3e7-1d02-0000-000000000025",
  "status": "PROCESSING",
  "transactionId": "Transaction:019542f5-b3e7-1d02-0000-000000000030",
  "source": { "accountId": "InternalAccount:e85dcbd6-dced-4ec4-b756-3c3a9ea3d965", "currency": "USD" },
  "destination": { "accountId": "ExternalAccount:a12dcbd6-dced-4ec4-b756-3c3a9ea3d123", "currency": "EUR" },
  "sendingAmount": { "amount": 10000, "currency": { "code": "USD", "decimals": 2 } },
  "receivingAmount": { "amount": 9200, "currency": { "code": "EUR", "decimals": 2 } },
  "exchangeRate": 0.92,
  "executedAt": "2025-10-03T15:05:00Z"
}
```

<Check>
  Once executed, the quote creates a transaction and the transfer begins processing. The `transactionId` can be used to track the payment.
</Check>
</Step>

<Step title="Monitor completion">
  Track the transfer using webhooks or by polling the transaction:

```bash
curl -X GET 'https://api.lightspark.com/grid/2025-10-13/transactions/Transaction:019542f5-b3e7-1d02-0000-000000000030' \
  -u "$GRID_CLIENT_ID:$GRID_CLIENT_SECRET"
```

You'll receive a webhook when the transaction completes:

```json
{
  "type": "OUTGOING_PAYMENT",
  "transaction": {
    "id": "Transaction:019542f5-b3e7-1d02-0000-000000000030",
    "status": "COMPLETED",
    "sentAmount": { "amount": 10000, "currency": { "code": "USD", "decimals": 2 } },
    "receivedAmount": { "amount": 9200, "currency": { "code": "EUR", "decimals": 2 } },
    "exchangeRate": 0.92,
    "settledAt": "2025-10-03T15:30:00Z",
    "quoteId": "Quote:019542f5-b3e7-1d02-0000-000000000025"
  },
  "timestamp": "2025-10-03T15:31:00Z"
}
```

</Step>
</Steps>

### Funding with cryptocurrencies

Cross-currency transfers support funding via USDC and BTC on popular blockchains including Solana, Base, Lightning and Spark. When you create a quote specifying the source currency as USDC or BTC, the response includes payment instructions for multiple funding options.

#### Supported blockchains

| Blockchain Network | Cryptocurrencies |
|-------|-------------|
| Solana | USDC |
| Base | USDC |
| Tron | USDT |
| Polygon | USDC |
| Lightning | BTC |
| Spark | BTC |

#### Create a quote for USDC-funded transfer

Request a quote that provides blockchain funding options:

```bash
curl -X POST 'https://api.lightspark.com/grid/2025-10-13/quotes' \
  -u "$GRID_CLIENT_ID:$GRID_CLIENT_SECRET" \
  -H 'Content-Type: application/json' \
  -d '{
    "source": {
      "sourceType": "REALTIME_FUNDING",
      "customerId": "Customer:019542f5-b3e7-1d02-0000-000000000001",
      "currency": "USDC"
    },
    "destination": { "destinationType": "ACCOUNT", "accountId": "ExternalAccount:a12dcbd6-dced-4ec4-b756-3c3a9ea3d123" },
    "lockedCurrencySide": "SENDING",
    "lockedCurrencyAmount": 10000,
    "description": "Payment for services - Invoice #1234"
  }'
```

The response includes an array of payment instructions, including blockchain wallet addresses for USDC and invoices for BTC:

```json Success (201 Created)
{
  "id": "Quote:019542f5-b3e7-1d02-0000-000000000025",
  "status": "PENDING",
  "source": { "customerId": "Customer:019542f5-b3e7-1d02-0000-000000000001", "currency": "USDC" },
  "destination": { "accountId": "ExternalAccount:a12dcbd6-dced-4ec4-b756-3c3a9ea3d123", "currency": "EUR" },
  "sendingAmount": { "amount": 10000, "currency": { "code": "USDC", "decimals": 2 } },
  "receivingAmount": { "amount": 9200, "currency": { "code": "EUR", "decimals": 2 } },
  "exchangeRate": 0.92,
  "fee": { "amount": 50, "currency": { "code": "USD", "decimals": 2 } },
  "expiresAt": "2025-10-03T15:15:00Z",
  "createdAt": "2025-10-03T15:00:00Z",
  "paymentInstructions": [
    {
      "accountOrWalletInfo": {
        "accountType": "SOLANA_WALLET",
        "assetType": "USDC",
        "address": "4Nd1m6Qkq7RfKuE5vQ9qP9Tn6H94Ueqb4xXHzsAbd8Wg"
      }
    },
    {
      "accountOrWalletInfo": {
        "accountType": "BASE_WALLET",
        "assetType": "USDC",
        "address": "0x1234567890abcdef1234567890abcdef12345678"
      }
    }
  ]
}
```

#### Transaction processing

Grid automatically detects blockchain deposits and processes the transfer once funds are received:

<Steps>
<Step title="Send USDC to the provided address">
  Transfer the exact amount of USDC specified in `sendingAmount` to your chosen blockchain wallet address.
</Step>

<Step title="Grid detects the deposit">
  Grid monitors the blockchain for incoming deposits. You'll receive an `ACCOUNT_STATUS` webhook when the deposit is confirmed:

```json
{
  "type": "ACCOUNT_STATUS",
  "accountId": "InternalAccount:019542f5-b3e7-1d02-0000-000000000025",
  "oldBalance": { "amount": 0, "currency": { "code": "USDC", "decimals": 2 } },
  "newBalance": { "amount": 10000, "currency": { "code": "USDC", "decimals": 2 } },
  "timestamp": "2025-10-03T15:05:00Z"
}
```
</Step>

<Step title="Transfer executes automatically">
  Once the deposit is confirmed, Grid executes the cross-currency transfer. You'll receive `OUTGOING_PAYMENT` webhooks as the transfer progresses and completes:

```json
{
  "type": "OUTGOING_PAYMENT",
  "transaction": {
    "id": "Transaction:019542f5-b3e7-1d02-0000-000000000030",
    "status": "COMPLETED",
    "sentAmount": { "amount": 10000, "currency": { "code": "USD", "decimals": 2 } },
    "receivedAmount": { "amount": 9200, "currency": { "code": "EUR", "decimals": 2 } },
    "exchangeRate": 0.92,
    "settledAt": "2025-10-03T15:30:00Z",
    "quoteId": "Quote:019542f5-b3e7-1d02-0000-000000000025"
  },
  "timestamp": "2025-10-03T15:31:00Z"
}
```
</Step>
</Steps>
